# -*- Tcl -*-

package require tcltest 2.2
namespace import -force ::tcltest::*

::tcltest::configure {*}$argv

test ns_sha1-1.1 {basic syntax: plain call} -body {
     ns_sha1
} -returnCodes error -result {wrong # args: should be "ns_sha1 string"}


test ns_sha1-2.1 {basic operation} -body {
     ns_sha1 foo
} -result "0BEEC7B5EA3F0FDBC95D0DD47F3C5BC275DA8A33"

test ns_sha1-2.2 {basic operation} -body {
     for {set i 0} {$i < 999} {incr i +1} {
         set nssha1([ns_sha1 foo]) .
     }
     llength [array names nssha1]
} -cleanup {
     array unset nssha1
} -result 1

test ns_sha1-2.3 {basic operation} -body {
     for {set i 0} {$i < 999} {incr i +1} {
         set nssha1([ns_sha1 $i]) .
     }
     llength [array names nssha1]
} -cleanup {
     array unset nssha1
} -result 999

test ns_sha1-2.4 {basic operation} -body {
     set hash1 [ns_sha1 ""]
     set hash2 [ns_sha1 {}]
     set hash3 [ns_sha1 [array names fjfjfjfjfj]]
     expr {($hash1 eq $hash2) == ($hash2 eq $hash3)}
} -result 1

test ns_sha1-2.5 {basic operation} -body {
    ns_sha1 [binary format H* 6501ff01]
} -result "97CE1CD8E5D85BA0913976868BC3EB024F6DD214"

test ns_sha1-2.6 {checksum from binary file} -body {
    set f [open [ns_server pagedir]/ns_poweredby.png]
    fconfigure $f -translation binary
    set c [read $f]
    close $f
    ns_sha1 $c
} -result "1BFB30C1892435CA0AD6042FA80CE6B222E5121A"


test ns_sha2-1.1 {basic syntax: plain call} -body {
     ns_sha2
} -returnCodes error -result {wrong # args: should be "ns_sha2 ?-length length? data"}
test ns_sha2-1.2 {basic syntax: plain call} -body {
     ns_sha2 -length 123 x
} -returnCodes error -result {bad option "123": must be 224, 256, 384, or 512}

test ns_sha2-2.0 {basic operation} -body {
     ns_sha2 foo
} -result "2C26B46B68FFC68FF99B453C1D30413413422D706483BFA0F98A5E886266E7AE"

test ns_sha2-2.1 {basic operation} -body {
     ns_sha2 -length 224 foo
} -result "0808F64E60D58979FCB676C96EC938270DEA42445AEEFCD3A4E6F8DB"

test ns_sha2-2.2 {basic operation} -body {
     ns_sha2 -length 256 foo
} -result "2C26B46B68FFC68FF99B453C1D30413413422D706483BFA0F98A5E886266E7AE"

test ns_sha2-2.3 {basic operation} -body {
     ns_sha2 -length 384 foo
} -result "98C11FFDFDD540676B1A137CB1A22B2A70350C9A44171D6B1180C6BE5CBB2EE3F79D532C8A1DD9EF2E8E08E752A3BABB"

test ns_sha2-2.4 {basic operation} -body {
     ns_sha2 -length 512 foo
} -result "F7FBBA6E0636F890E56FBBF3283E524C6FA3204AE298382D624741D0DC6638326E282C41BE5E4254D8820772C5518A2C5A8C0C7F7EDA19594A7EB539453E1ED7"

cleanupTests
